{"version":3,"sources":["carbon-intensity-widget.js"],"names":["document","window","undefined","leadingZero","n","createBanding","amount","colour","number","letter","todayOrTomorrow","time","tomorrow","moment","endOf","isSameOrBefore","createPlaceholders","target","placeholderWrapper","createElement","className","style","width","querySelector","maxWidth","placeholders","a","innerHTML","appendChild","populatePlaceholders","data","svg","querySelectorAll","highest","lowest","plugTemplate","message","boxWidth","boxHeight","template","createElementNS","setAttributeNS","createTextNode","b","length","from","tz","format","to","tomorrowCounter","thisHour","previousHour","parentElement","borderLeft","day","dayText","e","console","warn","c","banding","intensity","average","stroke","fill","top","error","color","backgroundColor","carbonForecasts","getElementsByClassName","i","start","end","timeFormat","duration","timeBlock","getAttribute","startOf","timeInUTC","timeLocal","localHour","UTCHour","roundedHour","parseInt","add","request","XMLHttpRequest","open","onreadystatechange","readyState","status","response","JSON","parse","responseText","send"],"mappings":"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","file":"carbon-intensity-widget.js","sourcesContent":["(function(document, window, undefined) {\r\n\r\n    let leadingZero = function (n) {\r\n        return (n < 10) ? (\"0\" + n) : n;\r\n    };\r\n\r\n    let createBanding = function(amount) {\r\n         if ( amount > 380) {\r\n            return {\r\n                colour: '#EE3350',\r\n                number: 8,\r\n                letter: 'VH'\r\n            };\r\n        }\r\n        else if ( amount > 280) {\r\n            return {\r\n                colour: '#F89834',\r\n                number: 6,\r\n                letter: 'H'\r\n            };\r\n        }\r\n        else if ( amount > 180) {\r\n            return {\r\n                colour: '#FFE600   ',\r\n                number: 4,\r\n                letter: 'M'\r\n            };\r\n        }\r\n        else if ( amount > 80) {\r\n            return {\r\n                colour: '#74C050',\r\n                number: 2,\r\n                letter: 'L'\r\n            };\r\n        }\r\n        else if ( amount > 0) {\r\n            return {\r\n                colour: '#74C050',\r\n                number: 0,\r\n                letter: 'VL'\r\n            };\r\n        }\r\n    };\r\n\r\n    let todayOrTomorrow = (time) => {\r\n        let tomorrow = moment().endOf('day');\r\n        if (moment(time).isSameOrBefore(tomorrow)) {\r\n            return 'today';\r\n        }\r\n        else {\r\n            return 'tomorrow';\r\n        }\r\n    };\r\n\r\n    let createPlaceholders = function(target, amount) {\r\n        let placeholderWrapper = document.createElement('section');\r\n            placeholderWrapper.className = 'wrapper';\r\n            placeholderWrapper.style.width = ( (7 * amount) * 16 ) + 'px';\r\n            document.querySelector('.logos').style.maxWidth = ( (7 * amount) * 16 ) + 'px';\r\n\r\n        let placeholders = '';\r\n\r\n        for (let a = 0; a < amount; a++) {\r\n            placeholders +=\r\n                `<div class=\"hour\">\r\n                    <p class=\"timestamp\"><time></time></p>\r\n                    <svg class=\"inactive icon--house\" width=\"149\" height=\"146\" viewBox=\"0 0 149 146\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M26 53.196L3 77h23v66h98V77h22L74.5 3 44 34.566V16H26v37.196z\" stroke=\"#676767\" stroke-width=\"7\" fill=\"rgba(255,255,255,1)\" fill-rule=\"evenodd\" stroke-linejoin=\"round\">\r\n                            <title>House</title>\r\n                        </path>\r\n                        <text x=\"59\" y=\"105\" font-family=\"'Open Sans', sans-serif\" font-size=\"40\" fill=\"#000\"></text>\r\n                    </svg>\r\n                </div>`;\r\n        }\r\n        placeholderWrapper.innerHTML += placeholders;\r\n        target.appendChild(placeholderWrapper);\r\n    };\r\n\r\n    let populatePlaceholders = function(target, data) {\r\n        let svg = target.querySelectorAll('svg');\r\n        let time = target.querySelectorAll('time');\r\n        let highest = 'uninitiated';\r\n        let lowest = 'uninitiated';\r\n\r\n        let plugTemplate = function(colour, message) {\r\n            let boxWidth = 49;\r\n            let boxHeight = 59;\r\n            let template = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n\r\n                template.setAttributeNS (null, 'viewBox', '0 0 ' + boxWidth + ' ' + boxHeight);\r\n                template.setAttributeNS (null, 'width', boxWidth);\r\n                template.setAttributeNS (null, 'height', boxHeight);\r\n                template.setAttributeNS(null, 'class', 'icon--plug');\r\n                template.innerHTML = `<g fill=\"none\" fill-rule=\"evenodd\">\r\n                                        <path d=\"M24.5 59V41.5M14 22V0M36 22V0\" stroke=\"${colour}\" stroke-width=\"9\" fill=\"${colour}\"/>\r\n                                        <path d=\"M.005 16c-.003.166-.005.333-.005.5C0 30.583 10.97 42 24.5 42S49 30.583 49 16.5c0-.167-.002-.334-.005-.5H.005z\" fill=\"${colour}\" />\r\n                                        </g>\r\n                                    </svg>`;\r\n\r\n            return [ template,  document.createTextNode(message) ];\r\n        };\r\n\r\n        for (let b = 0; b < data.length; b++) {\r\n            time[b].appendChild(\r\n                document.createTextNode(\r\n                    moment(data[b].from).tz('Europe/London').format('ha') + ' - ' + moment(data[b].to).tz('Europe/London').format('ha')\r\n                )\r\n            );\r\n        }\r\n\r\n        let tomorrowCounter = false;\r\n        for (let b = 0; b < data.length; b++) {\r\n            // console.log(\r\n            //     data[b].from,\r\n            //     moment(data[b].from).tz('Europe/London').format('YYYYMMDD hh:mm'),\r\n            //     moment(data[b].from).tz('UTC').format('YYYYMMDD hh:mm'),\r\n            //     todayOrTomorrow(data[b].from)\r\n            // );\r\n\r\n            if( b >= 1) {\r\n                let thisHour = moment(data[b].from).tz('Europe/London').format('YYYYMMDD');\r\n                let previousHour = moment(data[b - 1].from).tz('Europe/London').format('YYYYMMDD');\r\n                if ( thisHour !== previousHour ) {\r\n                    try {\r\n                        svg[b].parentElement.style.borderLeft = '2px dotted #999';\r\n                        let day = document.createElement('b');\r\n                        let dayText = document.createTextNode( moment(data[b].from).tz('Europe/London').format('dddd') );\r\n                        day.appendChild( dayText );\r\n                        time[b].appendChild(day);\r\n                    }\r\n                    catch(e) {\r\n                        console.warn(e);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let c = 0; c < data.length; c++) {\r\n            try {\r\n                let banding = createBanding(data[c].intensity.average);\r\n\r\n                if (highest === 'uninitiated') {\r\n                    highest = c;\r\n                }\r\n                else if ( data[c].intensity.average > data[highest].intensity.average) {\r\n                    highest = c;\r\n                }\r\n\r\n                if (lowest === 'uninitiated') {\r\n                    lowest = c;\r\n                }\r\n                else if ( data[c].intensity.average < data[lowest].intensity.average) {\r\n                    lowest = c;\r\n                }\r\n\r\n                svg[c].querySelector('path').style.stroke = banding.colour;\r\n                svg[c].querySelector('title').innerHTML = data[c].intensity.average + 'g CO₂ per kWh';\r\n                svg[c].querySelector('text').appendChild(document.createTextNode(banding.letter));\r\n                svg[c].querySelector('text').style.fill = '#676767';\r\n                svg[c].style.top = (9 - banding.number) + 'em';\r\n            }\r\n            catch (error) {\r\n                if (error) {\r\n                    console.warn(error);\r\n                    time[c].appendChild( document.createTextNode(' (Forecast not yet available)') );\r\n                    svg[c].querySelector('text').appendChild(document.createTextNode('?'));\r\n                    svg[c].querySelector('text').style.fill = '#ccc';\r\n                    throw error;\r\n                }\r\n            }\r\n\r\n            time[c].style.color = '#333';\r\n        }\r\n\r\n        time[highest].parentElement.appendChild( plugTemplate('#EE3350', 'Unplug')[0] );\r\n        time[highest].parentElement.appendChild( plugTemplate('#EE3350', 'Unplug')[1] );\r\n        time[lowest].parentElement.appendChild( plugTemplate('#74C050', 'Plug in')[0] );\r\n        time[lowest].parentElement.appendChild( plugTemplate('#74C050', 'Plug in')[1] );\r\n        time[lowest].parentElement.parentElement.style.backgroundColor = '#d6e8ce';\r\n        time[highest].parentElement.parentElement.style.backgroundColor = '#ffd3da';\r\n    };\r\n\r\n    let carbonForecasts = document.getElementsByClassName('carbon-forecast');\r\n\r\n    for (let i = 0; i < carbonForecasts.length; i++) {\r\n        let start;\r\n        let end;\r\n        let timeFormat = 'YYYY-MM-DD\\THH\\:mm';\r\n        let duration;\r\n        let timeBlock = 2;\r\n\r\n        if (carbonForecasts[i].getAttribute('data-duration')) {\r\n            duration = carbonForecasts[i].getAttribute('data-duration');\r\n        }\r\n        else {\r\n            duration = 24;\r\n        }\r\n\r\n        if (duration < 4) {\r\n            duration = 4;\r\n        }\r\n        else if (duration > 48) {\r\n            duration = 48;\r\n        }\r\n\r\n        if (carbonForecasts[i].getAttribute('data-from')) {\r\n            start = moment(carbonForecasts[i].getAttribute('data-from') ).startOf('hour').tz('UTC').format(timeFormat);\r\n        }\r\n        else {\r\n            let timeInUTC = moment().startOf('hour').tz('UTC');\r\n            let timeLocal = moment().startOf('hour').tz('Europe/London');\r\n            let localHour = timeLocal.format('HH');\r\n            let UTCHour = timeInUTC.format('HH');\r\n            let roundedHour;\r\n\r\n            if (parseInt(localHour) % 2 === 0) {\r\n                // is even\r\n                roundedHour = parseInt(UTCHour);\r\n            }\r\n            else {\r\n                // is odd\r\n                roundedHour = parseInt(UTCHour) - 1;\r\n            }\r\n\r\n            start = timeInUTC.format('YYYY-MM-DD\\T') + leadingZero(roundedHour) + ':00';\r\n        }\r\n        end = moment(start).add(duration, 'hours').tz('UTC').format(timeFormat);\r\n        createPlaceholders(carbonForecasts[i], duration / timeBlock);\r\n\r\n        let request = new XMLHttpRequest();\r\n            request.open('GET', `https://k1nehbcl85.execute-api.eu-west-2.amazonaws.com/v1/intensity/stats/${start}/${end}/${timeBlock}`, true);\r\n            request.onreadystatechange = function() {\r\n                if (this.readyState === 4) {\r\n                    if (this.status >= 200 && this.status < 400) {\r\n                        let response = JSON.parse(this.responseText);\r\n                        populatePlaceholders(carbonForecasts[i], response.data);\r\n                    } else {\r\n                        // Error :(\r\n                    }\r\n                }\r\n            };\r\n            request.send();\r\n            request = null;\r\n    }\r\n})(document, window);"]}
